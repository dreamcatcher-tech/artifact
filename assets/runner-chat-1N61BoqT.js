var It=(u,a,i)=>{if(!a.has(u))throw TypeError("Cannot "+i)};var m=(u,a,i)=>(It(u,a,"read from private field"),i?i.call(u):a.get(u)),P=(u,a,i)=>{if(a.has(u))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(u):a.set(u,i)},U=(u,a,i,l)=>(It(u,a,"write to private field"),l?l.call(u,i):a.set(u,i),i);var ft=(u,a,i)=>(It(u,a,"access private method"),i);import{g as Un,c as pt,a as _,l as ae,D as $n,d as Bn,O as Hn,s as Vn,p as Ln}from"./index-wbeOGLLB.js";import{i as Jn,a as Kn,b as dt,s as Wn,c as Zn}from"./io-hooks-5HwsB6Wu.js";var ht={exports:{}};ht.exports;(function(u,a){var i=200,l="__lodash_hash_undefined__",g=800,c=16,w=9007199254740991,b="[object Arguments]",y="[object Array]",v="[object AsyncFunction]",S="[object Boolean]",C="[object Date]",tt="[object Error]",V="[object Function]",et="[object GeneratorFunction]",L="[object Map]",J="[object Number]",_t="[object Null]",j="[object Object]",R="[object Proxy]",Rt="[object RegExp]",nt="[object Set]",se="[object String]",ce="[object Undefined]",ue="[object WeakMap]",le="[object ArrayBuffer]",fe="[object DataView]",pe="[object Float32Array]",de="[object Float64Array]",he="[object Int8Array]",ge="[object Int16Array]",_e="[object Int32Array]",ye="[object Uint8Array]",be="[object Uint8ClampedArray]",me="[object Uint16Array]",ve="[object Uint32Array]",Te=/[\\^$.*+?()[\]{}|]/g,we=/^\[object .+?Constructor\]$/,Ae=/^(?:0|[1-9]\d*)$/,p={};p[pe]=p[de]=p[he]=p[ge]=p[_e]=p[ye]=p[be]=p[me]=p[ve]=!0,p[b]=p[y]=p[le]=p[S]=p[fe]=p[C]=p[tt]=p[V]=p[L]=p[J]=p[j]=p[Rt]=p[nt]=p[se]=p[ue]=!1;var Nt=typeof pt=="object"&&pt&&pt.Object===Object&&pt,Oe=typeof self=="object"&&self&&self.Object===Object&&self,K=Nt||Oe||Function("return this")(),zt=a&&!a.nodeType&&a,W=zt&&!0&&u&&!u.nodeType&&u,Dt=W&&W.exports===zt,yt=Dt&&Nt.process,Ft=function(){try{var t=W&&W.require&&W.require("util").types;return t||yt&&yt.binding&&yt.binding("util")}catch{}}(),Mt=Ft&&Ft.isTypedArray;function xe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Se(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ce(t){return function(e){return t(e)}}function je(t,e){return t==null?void 0:t[e]}function Ie(t,e){return function(n){return t(e(n))}}var Ee=Array.prototype,Pe=Function.prototype,rt=Object.prototype,bt=K["__core-js_shared__"],at=Pe.toString,I=rt.hasOwnProperty,Gt=function(){var t=/[^.]+$/.exec(bt&&bt.keys&&bt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ut=rt.toString,Re=at.call(Object),Ne=RegExp("^"+at.call(I).replace(Te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),it=Dt?K.Buffer:void 0,$t=K.Symbol,Bt=K.Uint8Array,Ht=it?it.allocUnsafe:void 0,Vt=Ie(Object.getPrototypeOf,Object),Lt=Object.create,ze=rt.propertyIsEnumerable,De=Ee.splice,N=$t?$t.toStringTag:void 0,ot=function(){try{var t=Tt(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Fe=it?it.isBuffer:void 0,Jt=Math.max,Me=Date.now,Kt=Tt(K,"Map"),Z=Tt(Object,"create"),Ge=function(){function t(){}return function(e){if(!D(e))return{};if(Lt)return Lt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function z(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ue(){this.__data__=Z?Z(null):{},this.size=0}function $e(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Be(t){var e=this.__data__;if(Z){var n=e[t];return n===l?void 0:n}return I.call(e,t)?e[t]:void 0}function He(t){var e=this.__data__;return Z?e[t]!==void 0:I.call(e,t)}function Ve(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Z&&e===void 0?l:e,this}z.prototype.clear=Ue,z.prototype.delete=$e,z.prototype.get=Be,z.prototype.has=He,z.prototype.set=Ve;function E(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Le(){this.__data__=[],this.size=0}function Je(t){var e=this.__data__,n=st(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():De.call(e,n,1),--this.size,!0}function Ke(t){var e=this.__data__,n=st(e,t);return n<0?void 0:e[n][1]}function We(t){return st(this.__data__,t)>-1}function Ze(t,e){var n=this.__data__,r=st(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}E.prototype.clear=Le,E.prototype.delete=Je,E.prototype.get=Ke,E.prototype.has=We,E.prototype.set=Ze;function M(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function qe(){this.size=0,this.__data__={hash:new z,map:new(Kt||E),string:new z}}function Ye(t){var e=ut(this,t).delete(t);return this.size-=e?1:0,e}function Qe(t){return ut(this,t).get(t)}function Xe(t){return ut(this,t).has(t)}function ke(t,e){var n=ut(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}M.prototype.clear=qe,M.prototype.delete=Ye,M.prototype.get=Qe,M.prototype.has=Xe,M.prototype.set=ke;function G(t){var e=this.__data__=new E(t);this.size=e.size}function tn(){this.__data__=new E,this.size=0}function en(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function nn(t){return this.__data__.get(t)}function rn(t){return this.__data__.has(t)}function an(t,e){var n=this.__data__;if(n instanceof E){var r=n.__data__;if(!Kt||r.length<i-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new M(r)}return n.set(t,e),this.size=n.size,this}G.prototype.clear=tn,G.prototype.delete=en,G.prototype.get=nn,G.prototype.has=rn,G.prototype.set=an;function on(t,e){var n=Ot(t),r=!n&&At(t),s=!n&&!r&&Qt(t),f=!n&&!r&&!s&&kt(t),d=n||r||s||f,o=d?Se(t.length,String):[],h=o.length;for(var A in t)(e||I.call(t,A))&&!(d&&(A=="length"||s&&(A=="offset"||A=="parent")||f&&(A=="buffer"||A=="byteLength"||A=="byteOffset")||qt(A,h)))&&o.push(A);return o}function mt(t,e,n){(n!==void 0&&!lt(t[e],n)||n===void 0&&!(e in t))&&vt(t,e,n)}function sn(t,e,n){var r=t[e];(!(I.call(t,e)&&lt(r,n))||n===void 0&&!(e in t))&&vt(t,e,n)}function st(t,e){for(var n=t.length;n--;)if(lt(t[n][0],e))return n;return-1}function vt(t,e,n){e=="__proto__"&&ot?ot(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var cn=Tn();function ct(t){return t==null?t===void 0?ce:_t:N&&N in Object(t)?wn(t):jn(t)}function Wt(t){return q(t)&&ct(t)==b}function un(t){if(!D(t)||Sn(t))return!1;var e=St(t)?Ne:we;return e.test(Rn(t))}function ln(t){return q(t)&&Xt(t.length)&&!!p[ct(t)]}function fn(t){if(!D(t))return Cn(t);var e=Yt(t),n=[];for(var r in t)r=="constructor"&&(e||!I.call(t,r))||n.push(r);return n}function Zt(t,e,n,r,s){t!==e&&cn(e,function(f,d){if(s||(s=new G),D(f))pn(t,e,d,n,Zt,r,s);else{var o=r?r(wt(t,d),f,d+"",t,e,s):void 0;o===void 0&&(o=f),mt(t,d,o)}},te)}function pn(t,e,n,r,s,f,d){var o=wt(t,n),h=wt(e,n),A=d.get(h);if(A){mt(t,n,A);return}var T=f?f(o,h,n+"",t,e,d):void 0,Y=T===void 0;if(Y){var Ct=Ot(h),jt=!Ct&&Qt(h),ne=!Ct&&!jt&&kt(h);T=h,Ct||jt||ne?Ot(o)?T=o:Nn(o)?T=bn(o):jt?(Y=!1,T=gn(h,!0)):ne?(Y=!1,T=yn(h,!0)):T=[]:zn(h)||At(h)?(T=o,At(o)?T=Dn(o):(!D(o)||St(o))&&(T=An(h))):Y=!1}Y&&(d.set(h,T),s(T,h,r,f,d),d.delete(h)),mt(t,n,T)}function dn(t,e){return En(In(t,e,ee),t+"")}var hn=ot?function(t,e){return ot(t,"toString",{configurable:!0,enumerable:!1,value:Mn(e),writable:!0})}:ee;function gn(t,e){if(e)return t.slice();var n=t.length,r=Ht?Ht(n):new t.constructor(n);return t.copy(r),r}function _n(t){var e=new t.constructor(t.byteLength);return new Bt(e).set(new Bt(t)),e}function yn(t,e){var n=e?_n(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function bn(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function mn(t,e,n,r){var s=!n;n||(n={});for(var f=-1,d=e.length;++f<d;){var o=e[f],h=r?r(n[o],t[o],o,n,t):void 0;h===void 0&&(h=t[o]),s?vt(n,o,h):sn(n,o,h)}return n}function vn(t){return dn(function(e,n){var r=-1,s=n.length,f=s>1?n[s-1]:void 0,d=s>2?n[2]:void 0;for(f=t.length>3&&typeof f=="function"?(s--,f):void 0,d&&On(n[0],n[1],d)&&(f=s<3?void 0:f,s=1),e=Object(e);++r<s;){var o=n[r];o&&t(e,o,r,f)}return e})}function Tn(t){return function(e,n,r){for(var s=-1,f=Object(e),d=r(e),o=d.length;o--;){var h=d[t?o:++s];if(n(f[h],h,f)===!1)break}return e}}function ut(t,e){var n=t.__data__;return xn(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Tt(t,e){var n=je(t,e);return un(n)?n:void 0}function wn(t){var e=I.call(t,N),n=t[N];try{t[N]=void 0;var r=!0}catch{}var s=Ut.call(t);return r&&(e?t[N]=n:delete t[N]),s}function An(t){return typeof t.constructor=="function"&&!Yt(t)?Ge(Vt(t)):{}}function qt(t,e){var n=typeof t;return e=e??w,!!e&&(n=="number"||n!="symbol"&&Ae.test(t))&&t>-1&&t%1==0&&t<e}function On(t,e,n){if(!D(n))return!1;var r=typeof e;return(r=="number"?xt(n)&&qt(e,n.length):r=="string"&&e in n)?lt(n[e],t):!1}function xn(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Sn(t){return!!Gt&&Gt in t}function Yt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||rt;return t===n}function Cn(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}function jn(t){return Ut.call(t)}function In(t,e,n){return e=Jt(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,f=Jt(r.length-e,0),d=Array(f);++s<f;)d[s]=r[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=r[s];return o[e]=n(d),xe(t,this,o)}}function wt(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var En=Pn(hn);function Pn(t){var e=0,n=0;return function(){var r=Me(),s=c-(r-n);if(n=r,s>0){if(++e>=g)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Rn(t){if(t!=null){try{return at.call(t)}catch{}try{return t+""}catch{}}return""}function lt(t,e){return t===e||t!==t&&e!==e}var At=Wt(function(){return arguments}())?Wt:function(t){return q(t)&&I.call(t,"callee")&&!ze.call(t,"callee")},Ot=Array.isArray;function xt(t){return t!=null&&Xt(t.length)&&!St(t)}function Nn(t){return q(t)&&xt(t)}var Qt=Fe||Gn;function St(t){if(!D(t))return!1;var e=ct(t);return e==V||e==et||e==v||e==R}function Xt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=w}function D(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function q(t){return t!=null&&typeof t=="object"}function zn(t){if(!q(t)||ct(t)!=j)return!1;var e=Vt(t);if(e===null)return!0;var n=I.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&at.call(n)==Re}var kt=Mt?Ce(Mt):ln;function Dn(t){return mn(t,te(t))}function te(t){return xt(t)?on(t,!0):fn(t)}var Fn=vn(function(t,e,n){Zt(t,e,n)});function Mn(t){return function(){return t}}function ee(t){return t}function Gn(){return!1}u.exports=Fn})(ht,ht.exports);var qn=ht.exports;const Yn=Un(qn);var Qn={VITE_OPENAI_API_KEY:"c2stVWRlRWFIWWZxQVBkQ1czZVNuTmFUM0JsYmtGSkRSTnp5cW9rRjFmR0ZBdE80Sm9S",VITE_GIT_HASH:'"54448bbe6a76b49b88b1b52f56c3447caea99d79"',VITE_GIT_DATE:'"2024-01-21T22:27:38.000Z"',BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const O=$n("AI:runner-chat"),Xn=O.extend("ai-result-content"),re=O.extend("ai-part"),kn=O.extend("ai-result-tool"),tr=O.extend("ai-tool-result"),{VITE_OPENAI_API_KEY:ie}=Qn;if(!ie)throw new Error("missing openai api key");const er=Bn.Buffer.from(ie,"base64").toString("utf-8"),nr=new Hn({apiKey:er,dangerouslyAllowBrowser:!0}),cr=async({path:u,text:a})=>{_(typeof u=="string","help must be a string"),_(typeof a=="string","text must be a string");const i=await ae(u);return await(await Et.create(i)).prompt(a)};var $,Q,X,B,x,H,k,Pt,gt,oe;const F=class F{constructor(){P(this,k);P(this,gt);P(this,$,void 0);P(this,Q,void 0);P(this,X,void 0);P(this,B,void 0);P(this,x,void 0)}static async create(a){var l;_(typeof a=="object","help must be an object");const i=JSON.stringify(a);if(!m(F,H).has(i)){const g=new F;U(g,x,"/chat-1.session.json"),U(g,$,a.instructions.join(`
`).trim()),U(g,Q,a.config||{}),await ft(l=g,gt,oe).call(l,a.commands),m(F,H).set(i,g)}return m(F,H).get(i)}async prompt(a){var g;_(typeof a=="string","text must be a string"),_(a.length,"text must not be empty");let i=[];await Jn(m(this,x))&&(i=await Kn(m(this,x))),_(Array.isArray(i),"messages must be an array"),m(this,$)&&(((g=i[0])==null?void 0:g.role)==="system"&&i.shift(),i.unshift({role:"system",content:m(this,$)})),a&&i.push({role:"user",content:a});const l=await ft(this,k,Pt).call(this,i);return O("assistant",l),l}async executeTools(a){_(Array.isArray(a),"messages must be an array"),a=[...a];const i=a[a.length-1];if(!i.tool_calls)return Xn(i.content),i.content;for(const l of i.tool_calls){const{function:{name:g,arguments:c},id:w}=l;kn(g,c),O("tool call:",g,c),_(m(this,B)[g],`missing action: ${g}`);const b={role:"tool",tool_call_id:w};a.push(b),await dt(m(this,x),a);try{const y=JSON.parse(c),v=await m(this,B)[g](y);O("tool call result:",v),v===void 0||typeof v=="string"?b.content=v||"":b.content=JSON.stringify(v,null,2)}catch(y){O("tool call error:",y),b.content=JSON.stringify(Vn(y),null,2)}tr(b.content)}return await dt(m(this,x),a),ft(this,k,Pt).call(this,a)}};$=new WeakMap,Q=new WeakMap,X=new WeakMap,B=new WeakMap,x=new WeakMap,H=new WeakMap,k=new WeakSet,Pt=async function(a){var b,y,v,S,C,tt,V;const{model:i="gpt-4-1106-preview",temperature:l=0}=m(this,Q),g={model:i,temperature:l,messages:[...a],stream:!0,seed:1,tools:m(this,X)},c={role:"assistant"};a.push(c),await dt(m(this,x),a),O("streamCall started");const w=await nr.chat.completions.create(g);O("streamCall placed");for await(const et of w){const L=(y=(b=et.choices[0])==null?void 0:b.delta)==null?void 0:y.content;L&&(re(L),c.content||(c.content=""),c.content+=L);const J=(S=(v=et.choices[0])==null?void 0:v.delta)==null?void 0:S.tool_calls;if(J){_(Array.isArray(J),"toolCalls must be an array"),c.tool_calls||(c.tool_calls=[]);for(const _t of J){const{index:j,...R}=_t;_(Number.isInteger(j),"toolCalls index must be an integer"),c.tool_calls[j]||(c.tool_calls[j]={});const nt={function:{arguments:((C=c.tool_calls[j].function)==null?void 0:C.arguments)||""}};(tt=R==null?void 0:R.function)!=null&&tt.arguments&&(nt.function.arguments+=R.function.arguments),Yn(c.tool_calls[j],R,nt),re("%o",(V=c.tool_calls[j])==null?void 0:V.function)}}await dt(m(this,x),a)}return O("streamCall complete"),this.executeTools(a)},gt=new WeakSet,oe=async function(a){if(_(Array.isArray(a),"commands must be an array"),!a.length)return;const i=[],l=new Set,g={};for(const c of a){O("loading command:",c);let w,b,y;if(c.includes(":")){const[v,S]=c.split(":");y=S;const C=await Zn(v);_(C[y],`isolate missing command: ${c}`),b=C[y],w=ar(y,b)}else{_(c.startsWith("helps/"),`invalid help: ${c}`),y=Ln.basename(c);const v=await ae(y);_(v.description,`missing description: ${c}`);const{engage:S}=await Wn("engage-help");b=({text:C})=>S({help:y,text:C}),w=rr(y,v,S)}_(b,`missing action: ${c}`),_(!l.has(y),`duplicate action: ${c}`),l.add(y),_(typeof b=="function",`invalid action: ${b}`),g[y]=b,_(typeof w=="object",`invalid tool: ${w}`),i.push(w)}U(this,B,g),U(this,X,i)},P(F,H,new Map);let Et=F;const rr=(u,a,i)=>{const{api:l}=i;_(typeof l=="object","api must be an object"),_(typeof l.type=="string","api.type must be a string");const g={type:"object",additionalProperties:!1,required:["text"],properties:{text:l.properties.text}};return{type:"function",function:{name:u,description:a.description,parameters:g}}},ar=(u,a)=>{const{api:i}=a;_(typeof i=="object","api must be an object"),_(typeof i.type=="string","api.type must be a string");const{...l}=i;return delete l.title,delete l.description,{type:"function",function:{name:u,description:i.description,parameters:l}}};export{Et as AI,cr as default};
