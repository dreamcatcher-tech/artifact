var It=(c,a,i)=>{if(!a.has(c))throw TypeError("Cannot "+i)};var T=(c,a,i)=>(It(c,a,"read from private field"),i?i.call(c):a.get(c)),R=(c,a,i)=>{if(a.has(c))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(c):a.set(c,i)},U=(c,a,i,l)=>(It(c,a,"write to private field"),l?l.call(c,i):a.set(c,i),i);var pt=(c,a,i)=>(It(c,a,"access private method"),i);import{i as Gn,h as dt,b as _,D as Un,m as Bn,O as Hn,n as Ln,e as Vn,o as X,q as Jn,a as re,p as Kn,s as Wn}from"./index-smU_PL2H.js";var ht={exports:{}};ht.exports;(function(c,a){var i=200,l="__lodash_hash_undefined__",h=800,y=16,m=9007199254740991,b="[object Arguments]",v="[object Array]",g="[object AsyncFunction]",C="[object Boolean]",O="[object Date]",S="[object Error]",V="[object Function]",nt="[object GeneratorFunction]",J="[object Map]",K="[object Number]",_t="[object Null]",I="[object Object]",N="[object Proxy]",Rt="[object RegExp]",rt="[object Set]",se="[object String]",ce="[object Undefined]",ue="[object WeakMap]",le="[object ArrayBuffer]",fe="[object DataView]",pe="[object Float32Array]",de="[object Float64Array]",he="[object Int8Array]",ge="[object Int16Array]",_e="[object Int32Array]",ye="[object Uint8Array]",be="[object Uint8ClampedArray]",me="[object Uint16Array]",ve="[object Uint32Array]",Te=/[\\^$.*+?()[\]{}|]/g,we=/^\[object .+?Constructor\]$/,Ae=/^(?:0|[1-9]\d*)$/,f={};f[pe]=f[de]=f[he]=f[ge]=f[_e]=f[ye]=f[be]=f[me]=f[ve]=!0,f[b]=f[v]=f[le]=f[C]=f[fe]=f[O]=f[S]=f[V]=f[J]=f[K]=f[I]=f[Rt]=f[rt]=f[se]=f[ue]=!1;var Nt=typeof dt=="object"&&dt&&dt.Object===Object&&dt,Oe=typeof self=="object"&&self&&self.Object===Object&&self,W=Nt||Oe||Function("return this")(),zt=a&&!a.nodeType&&a,q=zt&&!0&&c&&!c.nodeType&&c,Dt=q&&q.exports===zt,yt=Dt&&Nt.process,Ft=function(){try{var t=q&&q.require&&q.require("util").types;return t||yt&&yt.binding&&yt.binding("util")}catch{}}(),$t=Ft&&Ft.isTypedArray;function xe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Se(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function je(t){return function(e){return t(e)}}function Ce(t,e){return t==null?void 0:t[e]}function Ie(t,e){return function(n){return t(e(n))}}var Ee=Array.prototype,Pe=Function.prototype,at=Object.prototype,bt=W["__core-js_shared__"],it=Pe.toString,E=at.hasOwnProperty,Mt=function(){var t=/[^.]+$/.exec(bt&&bt.keys&&bt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Gt=at.toString,Re=it.call(Object),Ne=RegExp("^"+it.call(E).replace(Te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ot=Dt?W.Buffer:void 0,Ut=W.Symbol,Bt=W.Uint8Array,Ht=ot?ot.allocUnsafe:void 0,Lt=Ie(Object.getPrototypeOf,Object),Vt=Object.create,ze=at.propertyIsEnumerable,De=Ee.splice,z=Ut?Ut.toStringTag:void 0,st=function(){try{var t=Tt(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Fe=ot?ot.isBuffer:void 0,Jt=Math.max,$e=Date.now,Kt=Tt(W,"Map"),Y=Tt(Object,"create"),Me=function(){function t(){}return function(e){if(!F(e))return{};if(Vt)return Vt(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function D(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ge(){this.__data__=Y?Y(null):{},this.size=0}function Ue(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Be(t){var e=this.__data__;if(Y){var n=e[t];return n===l?void 0:n}return E.call(e,t)?e[t]:void 0}function He(t){var e=this.__data__;return Y?e[t]!==void 0:E.call(e,t)}function Le(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Y&&e===void 0?l:e,this}D.prototype.clear=Ge,D.prototype.delete=Ue,D.prototype.get=Be,D.prototype.has=He,D.prototype.set=Le;function P(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ve(){this.__data__=[],this.size=0}function Je(t){var e=this.__data__,n=ct(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():De.call(e,n,1),--this.size,!0}function Ke(t){var e=this.__data__,n=ct(e,t);return n<0?void 0:e[n][1]}function We(t){return ct(this.__data__,t)>-1}function qe(t,e){var n=this.__data__,r=ct(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}P.prototype.clear=Ve,P.prototype.delete=Je,P.prototype.get=Ke,P.prototype.has=We,P.prototype.set=qe;function M(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Ye(){this.size=0,this.__data__={hash:new D,map:new(Kt||P),string:new D}}function Ze(t){var e=lt(this,t).delete(t);return this.size-=e?1:0,e}function Qe(t){return lt(this,t).get(t)}function Xe(t){return lt(this,t).has(t)}function ke(t,e){var n=lt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}M.prototype.clear=Ye,M.prototype.delete=Ze,M.prototype.get=Qe,M.prototype.has=Xe,M.prototype.set=ke;function G(t){var e=this.__data__=new P(t);this.size=e.size}function tn(){this.__data__=new P,this.size=0}function en(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function nn(t){return this.__data__.get(t)}function rn(t){return this.__data__.has(t)}function an(t,e){var n=this.__data__;if(n instanceof P){var r=n.__data__;if(!Kt||r.length<i-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new M(r)}return n.set(t,e),this.size=n.size,this}G.prototype.clear=tn,G.prototype.delete=en,G.prototype.get=nn,G.prototype.has=rn,G.prototype.set=an;function on(t,e){var n=Ot(t),r=!n&&At(t),s=!n&&!r&&Qt(t),u=!n&&!r&&!s&&kt(t),p=n||r||s||u,o=p?Se(t.length,String):[],d=o.length;for(var x in t)(e||E.call(t,x))&&!(p&&(x=="length"||s&&(x=="offset"||x=="parent")||u&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||Yt(x,d)))&&o.push(x);return o}function mt(t,e,n){(n!==void 0&&!ft(t[e],n)||n===void 0&&!(e in t))&&vt(t,e,n)}function sn(t,e,n){var r=t[e];(!(E.call(t,e)&&ft(r,n))||n===void 0&&!(e in t))&&vt(t,e,n)}function ct(t,e){for(var n=t.length;n--;)if(ft(t[n][0],e))return n;return-1}function vt(t,e,n){e=="__proto__"&&st?st(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var cn=Tn();function ut(t){return t==null?t===void 0?ce:_t:z&&z in Object(t)?wn(t):Cn(t)}function Wt(t){return Z(t)&&ut(t)==b}function un(t){if(!F(t)||Sn(t))return!1;var e=St(t)?Ne:we;return e.test(Rn(t))}function ln(t){return Z(t)&&Xt(t.length)&&!!f[ut(t)]}function fn(t){if(!F(t))return jn(t);var e=Zt(t),n=[];for(var r in t)r=="constructor"&&(e||!E.call(t,r))||n.push(r);return n}function qt(t,e,n,r,s){t!==e&&cn(e,function(u,p){if(s||(s=new G),F(u))pn(t,e,p,n,qt,r,s);else{var o=r?r(wt(t,p),u,p+"",t,e,s):void 0;o===void 0&&(o=u),mt(t,p,o)}},te)}function pn(t,e,n,r,s,u,p){var o=wt(t,n),d=wt(e,n),x=p.get(d);if(x){mt(t,n,x);return}var w=u?u(o,d,n+"",t,e,p):void 0,Q=w===void 0;if(Q){var jt=Ot(d),Ct=!jt&&Qt(d),ne=!jt&&!Ct&&kt(d);w=d,jt||Ct||ne?Ot(o)?w=o:Nn(o)?w=bn(o):Ct?(Q=!1,w=gn(d,!0)):ne?(Q=!1,w=yn(d,!0)):w=[]:zn(d)||At(d)?(w=o,At(o)?w=Dn(o):(!F(o)||St(o))&&(w=An(d))):Q=!1}Q&&(p.set(d,w),s(w,d,r,u,p),p.delete(d)),mt(t,n,w)}function dn(t,e){return En(In(t,e,ee),t+"")}var hn=st?function(t,e){return st(t,"toString",{configurable:!0,enumerable:!1,value:$n(e),writable:!0})}:ee;function gn(t,e){if(e)return t.slice();var n=t.length,r=Ht?Ht(n):new t.constructor(n);return t.copy(r),r}function _n(t){var e=new t.constructor(t.byteLength);return new Bt(e).set(new Bt(t)),e}function yn(t,e){var n=e?_n(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function bn(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function mn(t,e,n,r){var s=!n;n||(n={});for(var u=-1,p=e.length;++u<p;){var o=e[u],d=r?r(n[o],t[o],o,n,t):void 0;d===void 0&&(d=t[o]),s?vt(n,o,d):sn(n,o,d)}return n}function vn(t){return dn(function(e,n){var r=-1,s=n.length,u=s>1?n[s-1]:void 0,p=s>2?n[2]:void 0;for(u=t.length>3&&typeof u=="function"?(s--,u):void 0,p&&On(n[0],n[1],p)&&(u=s<3?void 0:u,s=1),e=Object(e);++r<s;){var o=n[r];o&&t(e,o,r,u)}return e})}function Tn(t){return function(e,n,r){for(var s=-1,u=Object(e),p=r(e),o=p.length;o--;){var d=p[t?o:++s];if(n(u[d],d,u)===!1)break}return e}}function lt(t,e){var n=t.__data__;return xn(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Tt(t,e){var n=Ce(t,e);return un(n)?n:void 0}function wn(t){var e=E.call(t,z),n=t[z];try{t[z]=void 0;var r=!0}catch{}var s=Gt.call(t);return r&&(e?t[z]=n:delete t[z]),s}function An(t){return typeof t.constructor=="function"&&!Zt(t)?Me(Lt(t)):{}}function Yt(t,e){var n=typeof t;return e=e??m,!!e&&(n=="number"||n!="symbol"&&Ae.test(t))&&t>-1&&t%1==0&&t<e}function On(t,e,n){if(!F(n))return!1;var r=typeof e;return(r=="number"?xt(n)&&Yt(e,n.length):r=="string"&&e in n)?ft(n[e],t):!1}function xn(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function Sn(t){return!!Mt&&Mt in t}function Zt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||at;return t===n}function jn(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}function Cn(t){return Gt.call(t)}function In(t,e,n){return e=Jt(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,u=Jt(r.length-e,0),p=Array(u);++s<u;)p[s]=r[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=r[s];return o[e]=n(p),xe(t,this,o)}}function wt(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var En=Pn(hn);function Pn(t){var e=0,n=0;return function(){var r=$e(),s=y-(r-n);if(n=r,s>0){if(++e>=h)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function Rn(t){if(t!=null){try{return it.call(t)}catch{}try{return t+""}catch{}}return""}function ft(t,e){return t===e||t!==t&&e!==e}var At=Wt(function(){return arguments}())?Wt:function(t){return Z(t)&&E.call(t,"callee")&&!ze.call(t,"callee")},Ot=Array.isArray;function xt(t){return t!=null&&Xt(t.length)&&!St(t)}function Nn(t){return Z(t)&&xt(t)}var Qt=Fe||Mn;function St(t){if(!F(t))return!1;var e=ut(t);return e==V||e==nt||e==g||e==N}function Xt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=m}function F(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Z(t){return t!=null&&typeof t=="object"}function zn(t){if(!Z(t)||ut(t)!=I)return!1;var e=Lt(t);if(e===null)return!0;var n=E.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&it.call(n)==Re}var kt=$t?je($t):ln;function Dn(t){return mn(t,te(t))}function te(t){return xt(t)?on(t,!0):fn(t)}var Fn=vn(function(t,e,n){qt(t,e,n)});function $n(t){return function(){return t}}function ee(t){return t}function Mn(){return!1}c.exports=Fn})(ht,ht.exports);var qn=ht.exports;const Yn=Gn(qn);var Zn={VITE_OPENAI_API_KEY:"c2stVWRlRWFIWWZxQVBkQ1czZVNuTmFUM0JsYmtGSkRSTnp5cW9rRjFmR0ZBdE80Sm9S",VITE_GIT_HASH:'"caa59760a203b0d778d1c2eb5fcb9d2babdbfa8f"',VITE_GIT_DATE:'"2024-01-26T02:49:58.000Z"',BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const A=Un("AI:runner-chat"),Qn=A.extend("ai-result-content"),ae=A.extend("ai-part"),Xn=A.extend("ai-result-tool"),kn=A.extend("ai-tool-result"),{VITE_OPENAI_API_KEY:ie}=Zn;if(!ie)throw new Error("missing openai api key");const tr=Bn.Buffer.from(ie,"base64").toString("utf-8"),er=new Hn({apiKey:tr,dangerouslyAllowBrowser:!0}),or=async({help:c,text:a})=>(_(typeof c=="object",`help must be an object: ${typeof c}`),_(typeof a=="string","text must be a string"),await(await Et.create(c)).prompt(a));var B,k,tt,H,j,L,et,Pt,gt,oe;const $=class ${constructor(){R(this,et);R(this,gt);R(this,B,void 0);R(this,k,void 0);R(this,tt,void 0);R(this,H,void 0);R(this,j,void 0)}static async create(a){var l;_(typeof a=="object","help must be an object");const i=JSON.stringify(a);if(!T($,L).has(i)){const h=new $;U(h,j,"/chat-1.session.json"),U(h,B,a.instructions.join(`
`).trim()),U(h,k,a.config||{}),await pt(l=h,gt,oe).call(l,a.commands),T($,L).set(i,h)}return T($,L).get(i)}async prompt(a){var h;_(typeof a=="string","text must be a string"),_(a.length,"text must not be empty");let i=[];await Ln(T(this,j))&&(i=await Vn(T(this,j))),_(Array.isArray(i),"messages must be an array"),T(this,B)&&(((h=i[0])==null?void 0:h.role)==="system"&&i.shift(),i.unshift({role:"system",content:T(this,B)})),a&&i.push({role:"user",content:a});const l=await pt(this,et,Pt).call(this,i);return A("assistant",l),l}async executeTools(a){_(Array.isArray(a),"messages must be an array"),a=[...a];const i=a[a.length-1];if(!i.tool_calls)return Qn(i.content),i.content;for(const l of i.tool_calls){const{function:{name:h,arguments:y},id:m}=l;Xn(h,y),A("tool call:",h,y),_(T(this,H)[h],`missing action: ${h}`);const b={role:"tool",tool_call_id:m};a.push(b),await X(T(this,j),a);try{const v=JSON.parse(y),g=await T(this,H)[h](v);if(A("tool call result:",g),g==="@@ARTIFACT_RELAY@@"){A("tool call relay");const O=a.slice(0,-1).reverse().findLast(({role:S})=>S==="tool");return _(O,"missing last tool call"),b.content=O.content,await X(T(this,j),a),b.content}g===void 0||typeof g=="string"?b.content=g||"":b.content=JSON.stringify(g,null,2)}catch(v){A("tool call error:",v),b.content=JSON.stringify(Jn(v),null,2)}kn(b.content)}return await X(T(this,j),a),pt(this,et,Pt).call(this,a)}};B=new WeakMap,k=new WeakMap,tt=new WeakMap,H=new WeakMap,j=new WeakMap,L=new WeakMap,et=new WeakSet,Pt=async function(a){var b,v,g,C,O,S,V;const{model:i="gpt-4-1106-preview",temperature:l=0}=T(this,k),h={model:i,temperature:l,messages:[...a],stream:!0,seed:1,tools:T(this,tt)},y={role:"assistant"};a.push(y),await X(T(this,j),a),A("streamCall started");const m=await er.chat.completions.create(h);A("streamCall placed");for await(const nt of m){const J=(v=(b=nt.choices[0])==null?void 0:b.delta)==null?void 0:v.content;J&&(ae(J),y.content||(y.content=""),y.content+=J);const K=(C=(g=nt.choices[0])==null?void 0:g.delta)==null?void 0:C.tool_calls;if(K){_(Array.isArray(K),"toolCalls must be an array"),y.tool_calls||(y.tool_calls=[]);for(const _t of K){const{index:I,...N}=_t;_(Number.isInteger(I),"toolCalls index must be an integer"),y.tool_calls[I]||(y.tool_calls[I]={});const rt={function:{arguments:((O=y.tool_calls[I].function)==null?void 0:O.arguments)||""}};(S=N==null?void 0:N.function)!=null&&S.arguments&&(rt.function.arguments+=N.function.arguments),Yn(y.tool_calls[I],N,rt),ae("%o",(V=y.tool_calls[I])==null?void 0:V.function)}}await X(T(this,j),a)}return A("streamCall complete"),this.executeTools(a)},gt=new WeakSet,oe=async function(a){if(_(Array.isArray(a),"commands must be an array"),!a.length)return;const{load:i}=await re("load-help"),l=[],h=new Set,y={};for(const m of a){A("loading command:",m);let b,v,g;if(m.includes(":")){const[C,O]=m.split(":");g=O;const S=await re(C);_(S[g],`isolate missing command: ${m}`),v=S[g],b=rr(g,v)}else{_(m.startsWith("helps/"),`invalid help: ${m}`),g=Kn.basename(m);const C=await i({help:g});_(C.description,`missing description: ${m}`);const{engage:O}=await Wn("engage-help");v=({text:S})=>O({help:g,text:S}),b=nr(g,C,O)}_(v,`missing action: ${m}`),_(!h.has(g),`duplicate action: ${m}`),h.add(g),_(typeof v=="function",`invalid action: ${v}`),y[g]=v,_(typeof b=="object",`invalid tool: ${b}`),l.push(b)}U(this,H,y),U(this,tt,l)},R($,L,new Map);let Et=$;const nr=(c,a,i)=>{const{api:l}=i;_(typeof l=="object","api must be an object"),_(typeof l.type=="string","api.type must be a string");const h={type:"object",additionalProperties:!1,required:["text"],properties:{text:l.properties.text}};return{type:"function",function:{name:c,description:a.description,parameters:h}}},rr=(c,a)=>{const{api:i}=a;_(typeof i=="object",`api must be an object: ${c}`),_(typeof i.type=="string",`api.type must be a string: ${c}`);const{...l}=i;return delete l.title,delete l.description,{type:"function",function:{name:c,description:i.description,parameters:l}}};export{Et as AI,or as default};
