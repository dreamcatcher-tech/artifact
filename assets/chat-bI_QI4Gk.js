import{g as mr,c as et,D as vr,b as Tr,O as Ar,a as N}from"./index-7RzTCwVG.js";var nt={exports:{}};nt.exports;(function(h,A){var I=200,M="__lodash_hash_undefined__",w=800,d=16,U=9007199254740991,B="[object Arguments]",c="[object Array]",at="[object AsyncFunction]",G="[object Boolean]",H="[object Date]",L="[object Error]",x="[object Function]",V="[object GeneratorFunction]",K="[object Map]",J="[object Number]",$="[object Null]",j="[object Object]",E="[object Proxy]",it="[object RegExp]",y="[object Set]",b="[object String]",C="[object Undefined]",Kt="[object WeakMap]",Jt="[object ArrayBuffer]",$t="[object DataView]",Wt="[object Float32Array]",Yt="[object Float64Array]",Zt="[object Int8Array]",qt="[object Int16Array]",Qt="[object Int32Array]",Xt="[object Uint8Array]",kt="[object Uint8ClampedArray]",te="[object Uint16Array]",ee="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,ne=/^\[object .+?Constructor\]$/,ae=/^(?:0|[1-9]\d*)$/,s={};s[Wt]=s[Yt]=s[Zt]=s[qt]=s[Qt]=s[Xt]=s[kt]=s[te]=s[ee]=!0,s[B]=s[c]=s[Jt]=s[G]=s[$t]=s[H]=s[L]=s[x]=s[K]=s[J]=s[j]=s[it]=s[y]=s[b]=s[Kt]=!1;var yt=typeof et=="object"&&et&&et.Object===Object&&et,ie=typeof self=="object"&&self&&self.Object===Object&&self,P=yt||ie||Function("return this")(),mt=A&&!A.nodeType&&A,R=mt&&!0&&h&&!h.nodeType&&h,vt=R&&R.exports===mt,ot=vt&&yt.process,Tt=function(){try{var t=R&&R.require&&R.require("util").types;return t||ot&&ot.binding&&ot.binding("util")}catch{}}(),At=Tt&&Tt.isTypedArray;function oe(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function se(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}function ue(t){return function(e){return t(e)}}function fe(t,e){return t==null?void 0:t[e]}function ce(t,e){return function(r){return t(e(r))}}var le=Array.prototype,pe=Function.prototype,W=Object.prototype,st=P["__core-js_shared__"],Y=pe.toString,g=W.hasOwnProperty,wt=function(){var t=/[^.]+$/.exec(st&&st.keys&&st.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ct=W.toString,he=Y.call(Object),de=RegExp("^"+Y.call(g).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Z=vt?P.Buffer:void 0,Ot=P.Symbol,St=P.Uint8Array,It=Z?Z.allocUnsafe:void 0,xt=ce(Object.getPrototypeOf,Object),jt=Object.create,ge=W.propertyIsEnumerable,_e=le.splice,m=Ot?Ot.toStringTag:void 0,q=function(){try{var t=ct(Object,"defineProperty");return t({},"",{}),t}catch{}}(),be=Z?Z.isBuffer:void 0,Et=Math.max,ye=Date.now,Pt=ct(P,"Map"),z=ct(Object,"create"),me=function(){function t(){}return function(e){if(!T(e))return{};if(jt)return jt(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();function v(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function ve(){this.__data__=z?z(null):{},this.size=0}function Te(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Ae(t){var e=this.__data__;if(z){var r=e[t];return r===M?void 0:r}return g.call(e,t)?e[t]:void 0}function we(t){var e=this.__data__;return z?e[t]!==void 0:g.call(e,t)}function Ce(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=z&&e===void 0?M:e,this}v.prototype.clear=ve,v.prototype.delete=Te,v.prototype.get=Ae,v.prototype.has=we,v.prototype.set=Ce;function _(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Oe(){this.__data__=[],this.size=0}function Se(t){var e=this.__data__,r=Q(e,t);if(r<0)return!1;var n=e.length-1;return r==n?e.pop():_e.call(e,r,1),--this.size,!0}function Ie(t){var e=this.__data__,r=Q(e,t);return r<0?void 0:e[r][1]}function xe(t){return Q(this.__data__,t)>-1}function je(t,e){var r=this.__data__,n=Q(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}_.prototype.clear=Oe,_.prototype.delete=Se,_.prototype.get=Ie,_.prototype.has=xe,_.prototype.set=je;function O(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function Ee(){this.size=0,this.__data__={hash:new v,map:new(Pt||_),string:new v}}function Pe(t){var e=k(this,t).delete(t);return this.size-=e?1:0,e}function Re(t){return k(this,t).get(t)}function ze(t){return k(this,t).has(t)}function De(t,e){var r=k(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}O.prototype.clear=Ee,O.prototype.delete=Pe,O.prototype.get=Re,O.prototype.has=ze,O.prototype.set=De;function S(t){var e=this.__data__=new _(t);this.size=e.size}function Fe(){this.__data__=new _,this.size=0}function Ne(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function Me(t){return this.__data__.get(t)}function Ue(t){return this.__data__.has(t)}function Be(t,e){var r=this.__data__;if(r instanceof _){var n=r.__data__;if(!Pt||n.length<I-1)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new O(n)}return r.set(t,e),this.size=r.size,this}S.prototype.clear=Fe,S.prototype.delete=Ne,S.prototype.get=Me,S.prototype.has=Ue,S.prototype.set=Be;function Ge(t,e){var r=ht(t),n=!r&&pt(t),i=!r&&!n&&Nt(t),o=!r&&!n&&!i&&Ut(t),u=r||n||i||o,a=u?se(t.length,String):[],f=a.length;for(var p in t)(e||g.call(t,p))&&!(u&&(p=="length"||i&&(p=="offset"||p=="parent")||o&&(p=="buffer"||p=="byteLength"||p=="byteOffset")||Dt(p,f)))&&a.push(p);return a}function ut(t,e,r){(r!==void 0&&!tt(t[e],r)||r===void 0&&!(e in t))&&ft(t,e,r)}function He(t,e,r){var n=t[e];(!(g.call(t,e)&&tt(n,r))||r===void 0&&!(e in t))&&ft(t,e,r)}function Q(t,e){for(var r=t.length;r--;)if(tt(t[r][0],e))return r;return-1}function ft(t,e,r){e=="__proto__"&&q?q(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}var Le=er();function X(t){return t==null?t===void 0?C:$:m&&m in Object(t)?rr(t):ur(t)}function Rt(t){return D(t)&&X(t)==B}function Ve(t){if(!T(t)||or(t))return!1;var e=gt(t)?de:ne;return e.test(pr(t))}function Ke(t){return D(t)&&Mt(t.length)&&!!s[X(t)]}function Je(t){if(!T(t))return sr(t);var e=Ft(t),r=[];for(var n in t)n=="constructor"&&(e||!g.call(t,n))||r.push(n);return r}function zt(t,e,r,n,i){t!==e&&Le(e,function(o,u){if(i||(i=new S),T(o))$e(t,e,u,r,zt,n,i);else{var a=n?n(lt(t,u),o,u+"",t,e,i):void 0;a===void 0&&(a=o),ut(t,u,a)}},Bt)}function $e(t,e,r,n,i,o,u){var a=lt(t,r),f=lt(e,r),p=u.get(f);if(p){ut(t,r,p);return}var l=o?o(a,f,r+"",t,e,u):void 0,F=l===void 0;if(F){var _t=ht(f),bt=!_t&&Nt(f),Ht=!_t&&!bt&&Ut(f);l=f,_t||bt||Ht?ht(a)?l=a:hr(a)?l=Xe(a):bt?(F=!1,l=Ze(f,!0)):Ht?(F=!1,l=Qe(f,!0)):l=[]:dr(f)||pt(f)?(l=a,pt(a)?l=gr(a):(!T(a)||gt(a))&&(l=nr(f))):F=!1}F&&(u.set(f,l),i(l,f,n,o,u),u.delete(f)),ut(t,r,l)}function We(t,e){return cr(fr(t,e,Gt),t+"")}var Ye=q?function(t,e){return q(t,"toString",{configurable:!0,enumerable:!1,value:br(e),writable:!0})}:Gt;function Ze(t,e){if(e)return t.slice();var r=t.length,n=It?It(r):new t.constructor(r);return t.copy(n),n}function qe(t){var e=new t.constructor(t.byteLength);return new St(e).set(new St(t)),e}function Qe(t,e){var r=e?qe(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function Xe(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}function ke(t,e,r,n){var i=!r;r||(r={});for(var o=-1,u=e.length;++o<u;){var a=e[o],f=n?n(r[a],t[a],a,r,t):void 0;f===void 0&&(f=t[a]),i?ft(r,a,f):He(r,a,f)}return r}function tr(t){return We(function(e,r){var n=-1,i=r.length,o=i>1?r[i-1]:void 0,u=i>2?r[2]:void 0;for(o=t.length>3&&typeof o=="function"?(i--,o):void 0,u&&ar(r[0],r[1],u)&&(o=i<3?void 0:o,i=1),e=Object(e);++n<i;){var a=r[n];a&&t(e,a,n,o)}return e})}function er(t){return function(e,r,n){for(var i=-1,o=Object(e),u=n(e),a=u.length;a--;){var f=u[t?a:++i];if(r(o[f],f,o)===!1)break}return e}}function k(t,e){var r=t.__data__;return ir(e)?r[typeof e=="string"?"string":"hash"]:r.map}function ct(t,e){var r=fe(t,e);return Ve(r)?r:void 0}function rr(t){var e=g.call(t,m),r=t[m];try{t[m]=void 0;var n=!0}catch{}var i=Ct.call(t);return n&&(e?t[m]=r:delete t[m]),i}function nr(t){return typeof t.constructor=="function"&&!Ft(t)?me(xt(t)):{}}function Dt(t,e){var r=typeof t;return e=e??U,!!e&&(r=="number"||r!="symbol"&&ae.test(t))&&t>-1&&t%1==0&&t<e}function ar(t,e,r){if(!T(r))return!1;var n=typeof e;return(n=="number"?dt(r)&&Dt(e,r.length):n=="string"&&e in r)?tt(r[e],t):!1}function ir(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function or(t){return!!wt&&wt in t}function Ft(t){var e=t&&t.constructor,r=typeof e=="function"&&e.prototype||W;return t===r}function sr(t){var e=[];if(t!=null)for(var r in Object(t))e.push(r);return e}function ur(t){return Ct.call(t)}function fr(t,e,r){return e=Et(e===void 0?t.length-1:e,0),function(){for(var n=arguments,i=-1,o=Et(n.length-e,0),u=Array(o);++i<o;)u[i]=n[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=n[i];return a[e]=r(u),oe(t,this,a)}}function lt(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var cr=lr(Ye);function lr(t){var e=0,r=0;return function(){var n=ye(),i=d-(n-r);if(r=n,i>0){if(++e>=w)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function pr(t){if(t!=null){try{return Y.call(t)}catch{}try{return t+""}catch{}}return""}function tt(t,e){return t===e||t!==t&&e!==e}var pt=Rt(function(){return arguments}())?Rt:function(t){return D(t)&&g.call(t,"callee")&&!ge.call(t,"callee")},ht=Array.isArray;function dt(t){return t!=null&&Mt(t.length)&&!gt(t)}function hr(t){return D(t)&&dt(t)}var Nt=be||yr;function gt(t){if(!T(t))return!1;var e=X(t);return e==x||e==V||e==at||e==E}function Mt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=U}function T(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function D(t){return t!=null&&typeof t=="object"}function dr(t){if(!D(t)||X(t)!=j)return!1;var e=xt(t);if(e===null)return!0;var r=g.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&Y.call(r)==he}var Ut=At?ue(At):Ke;function gr(t){return ke(t,Bt(t))}function Bt(t){return dt(t)?Ge(t,!0):Je(t)}var _r=tr(function(t,e,r){zt(t,e,r)});function br(t){return function(){return t}}function Gt(t){return t}function yr(){return!1}h.exports=_r})(nt,nt.exports);var wr=nt.exports;const Lt=mr(wr),Cr=()=>globalThis["@@io-worker-hooks"];var Or={VITE_OPENAI_API_KEY:"c2stVWRlRWFIWWZxQVBkQ1czZVNuTmFUM0JsYmtGSkRSTnp5cW9rRjFmR0ZBdE80Sm9S",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const rt=vr("AI:isolate-chat"),Sr="gpt-3.5-turbo-1106",{VITE_OPENAI_API_KEY:Vt}=Or;if(!Vt)throw new Error("missing openai api key");const Ir=Tr.Buffer.from(Vt,"base64").toString("utf-8"),xr=new Ar({apiKey:Ir,dangerouslyAllowBrowser:!0}),Pr={prompt:{description:"prompt the AI",type:"object",properties:{text:{description:"the text to prompt the AI with",type:"string"}}}},Rr={prompt:async({text:h},A)=>{var G,H,L,x,V,K,J;N(typeof h=="string","text must be a string"),N(h.length,"text must not be empty");const{sessionPath:I,systemPromptPath:M}=A,w=Cr(),d=await w.readJS(I);N(Array.isArray(d),"messages must be an array");const U=await w.readFile(M);d.shift(),d.unshift({role:"assistant",content:U}),d.push({role:"user",content:h});const B={model:Sr,temperature:0,messages:[...d],stream:!0,seed:1337},c={role:"assistant"};d.push(c),await w.writeJS(d,I),rt("streamCall started");const at=await xr.chat.completions.create(B);rt("streamCall placed");for await(const $ of at){const j=((H=(G=$.choices[0])==null?void 0:G.delta)==null?void 0:H.content)||"";rt("streamCall part",j),c.content||(c.content=""),c.content+=j;const E=(x=(L=$.choices[0])==null?void 0:L.delta)==null?void 0:x.tool_calls;if(E){N(Array.isArray(E),"toolCalls must be an array"),c.toolCalls||(c.toolCalls=[]);for(const it of E){let{index:y,...b}=it;N(Number.isInteger(y),"toolCalls index must be an integer");let C=((K=(V=c.toolCalls[y])==null?void 0:V.function)==null?void 0:K.arguments)||"";C+=((J=b==null?void 0:b.function)==null?void 0:J.arguments)||"",C&&jr(C)&&(c.toolCalls[y]||(c.toolCalls[y]={}),b=Lt({},b,{function:{arguments:JSON.parse(C)}}),Lt(c.toolCalls[y],b))}}await w.writeJS(d,I)}return rt("streamCall complete"),c}},jr=h=>{try{return JSON.parse(h),!0}catch{return!1}};export{Pr as api,Rr as functions};
