var Ct=(f,a,i)=>{if(!a.has(f))throw TypeError("Cannot "+i)};var y=(f,a,i)=>(Ct(f,a,"read from private field"),i?i.call(f):a.get(f)),j=(f,a,i)=>{if(a.has(f))throw TypeError("Cannot add the same private member more than once");a instanceof WeakSet?a.add(f):a.set(f,i)},U=(f,a,i,c)=>(Ct(f,a,"write to private field"),c?c.call(f,i):a.set(f,i),i);var ct=(f,a,i)=>(Ct(f,a,"access private method"),i);import{g as Mn,c as ut,b,D as Un,d as Bn,O as Gn,s as $n}from"./index-U6WPJCyO.js";import{i as Hn,r as Ln,w as ft,a as Vn}from"./io-hooks-owRwVRpY.js";var lt={exports:{}};lt.exports;(function(f,a){var i=200,c="__lodash_hash_undefined__",g=800,d=16,O=9007199254740991,_="[object Arguments]",T="[object Array]",m="[object AsyncFunction]",Q="[object Boolean]",X="[object Date]",k="[object Error]",D="[object Function]",ht="[object GeneratorFunction]",I="[object Map]",E="[object Number]",It="[object Null]",H="[object Object]",ne="[object Proxy]",re="[object RegExp]",ae="[object Set]",ie="[object String]",oe="[object Undefined]",se="[object WeakMap]",ce="[object ArrayBuffer]",ue="[object DataView]",fe="[object Float32Array]",le="[object Float64Array]",pe="[object Int8Array]",he="[object Int16Array]",de="[object Int32Array]",ge="[object Uint8Array]",_e="[object Uint8ClampedArray]",ye="[object Uint16Array]",be="[object Uint32Array]",me=/[\\^$.*+?()[\]{}|]/g,ve=/^\[object .+?Constructor\]$/,we=/^(?:0|[1-9]\d*)$/,l={};l[fe]=l[le]=l[pe]=l[he]=l[de]=l[ge]=l[_e]=l[ye]=l[be]=!0,l[_]=l[T]=l[ce]=l[Q]=l[ue]=l[X]=l[k]=l[D]=l[I]=l[E]=l[H]=l[re]=l[ae]=l[ie]=l[se]=!1;var Et=typeof ut=="object"&&ut&&ut.Object===Object&&ut,Te=typeof self=="object"&&self&&self.Object===Object&&self,L=Et||Te||Function("return this")(),Pt=a&&!a.nodeType&&a,V=Pt&&!0&&f&&!f.nodeType&&f,Nt=V&&V.exports===Pt,dt=Nt&&Et.process,zt=function(){try{var t=V&&V.require&&V.require("util").types;return t||dt&&dt.binding&&dt.binding("util")}catch{}}(),Rt=zt&&zt.isTypedArray;function Ae(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Oe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Se(t){return function(e){return t(e)}}function Ce(t,e){return t==null?void 0:t[e]}function je(t,e){return function(n){return t(e(n))}}var xe=Array.prototype,Ie=Function.prototype,tt=Object.prototype,gt=L["__core-js_shared__"],et=Ie.toString,S=tt.hasOwnProperty,Dt=function(){var t=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Ft=tt.toString,Ee=et.call(Object),Pe=RegExp("^"+et.call(S).replace(me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=Nt?L.Buffer:void 0,Mt=L.Symbol,Ut=L.Uint8Array,Bt=nt?nt.allocUnsafe:void 0,Gt=je(Object.getPrototypeOf,Object),$t=Object.create,Ne=tt.propertyIsEnumerable,ze=xe.splice,P=Mt?Mt.toStringTag:void 0,rt=function(){try{var t=bt(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Re=nt?nt.isBuffer:void 0,Ht=Math.max,De=Date.now,Lt=bt(L,"Map"),J=bt(Object,"create"),Fe=function(){function t(){}return function(e){if(!z(e))return{};if($t)return $t(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function N(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Me(){this.__data__=J?J(null):{},this.size=0}function Ue(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Be(t){var e=this.__data__;if(J){var n=e[t];return n===c?void 0:n}return S.call(e,t)?e[t]:void 0}function Ge(t){var e=this.__data__;return J?e[t]!==void 0:S.call(e,t)}function $e(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=J&&e===void 0?c:e,this}N.prototype.clear=Me,N.prototype.delete=Ue,N.prototype.get=Be,N.prototype.has=Ge,N.prototype.set=$e;function C(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function He(){this.__data__=[],this.size=0}function Le(t){var e=this.__data__,n=at(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():ze.call(e,n,1),--this.size,!0}function Ve(t){var e=this.__data__,n=at(e,t);return n<0?void 0:e[n][1]}function Je(t){return at(this.__data__,t)>-1}function Ke(t,e){var n=this.__data__,r=at(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}C.prototype.clear=He,C.prototype.delete=Le,C.prototype.get=Ve,C.prototype.has=Je,C.prototype.set=Ke;function F(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function We(){this.size=0,this.__data__={hash:new N,map:new(Lt||C),string:new N}}function Ye(t){var e=ot(this,t).delete(t);return this.size-=e?1:0,e}function Ze(t){return ot(this,t).get(t)}function qe(t){return ot(this,t).has(t)}function Qe(t,e){var n=ot(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}F.prototype.clear=We,F.prototype.delete=Ye,F.prototype.get=Ze,F.prototype.has=qe,F.prototype.set=Qe;function M(t){var e=this.__data__=new C(t);this.size=e.size}function Xe(){this.__data__=new C,this.size=0}function ke(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function tn(t){return this.__data__.get(t)}function en(t){return this.__data__.has(t)}function nn(t,e){var n=this.__data__;if(n instanceof C){var r=n.__data__;if(!Lt||r.length<i-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new F(r)}return n.set(t,e),this.size=n.size,this}M.prototype.clear=Xe,M.prototype.delete=ke,M.prototype.get=tn,M.prototype.has=en,M.prototype.set=nn;function rn(t,e){var n=wt(t),r=!n&&vt(t),s=!n&&!r&&Yt(t),u=!n&&!r&&!s&&qt(t),p=n||r||s||u,o=p?Oe(t.length,String):[],h=o.length;for(var w in t)(e||S.call(t,w))&&!(p&&(w=="length"||s&&(w=="offset"||w=="parent")||u&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||Kt(w,h)))&&o.push(w);return o}function _t(t,e,n){(n!==void 0&&!st(t[e],n)||n===void 0&&!(e in t))&&yt(t,e,n)}function an(t,e,n){var r=t[e];(!(S.call(t,e)&&st(r,n))||n===void 0&&!(e in t))&&yt(t,e,n)}function at(t,e){for(var n=t.length;n--;)if(st(t[n][0],e))return n;return-1}function yt(t,e,n){e=="__proto__"&&rt?rt(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var on=mn();function it(t){return t==null?t===void 0?oe:It:P&&P in Object(t)?vn(t):Cn(t)}function Vt(t){return K(t)&&it(t)==_}function sn(t){if(!z(t)||On(t))return!1;var e=At(t)?Pe:ve;return e.test(En(t))}function cn(t){return K(t)&&Zt(t.length)&&!!l[it(t)]}function un(t){if(!z(t))return Sn(t);var e=Wt(t),n=[];for(var r in t)r=="constructor"&&(e||!S.call(t,r))||n.push(r);return n}function Jt(t,e,n,r,s){t!==e&&on(e,function(u,p){if(s||(s=new M),z(u))fn(t,e,p,n,Jt,r,s);else{var o=r?r(mt(t,p),u,p+"",t,e,s):void 0;o===void 0&&(o=u),_t(t,p,o)}},Qt)}function fn(t,e,n,r,s,u,p){var o=mt(t,n),h=mt(e,n),w=p.get(h);if(w){_t(t,n,w);return}var v=u?u(o,h,n+"",t,e,p):void 0,W=v===void 0;if(W){var Ot=wt(h),St=!Ot&&Yt(h),kt=!Ot&&!St&&qt(h);v=h,Ot||St||kt?wt(o)?v=o:Pn(o)?v=_n(o):St?(W=!1,v=hn(h,!0)):kt?(W=!1,v=gn(h,!0)):v=[]:Nn(h)||vt(h)?(v=o,vt(o)?v=zn(o):(!z(o)||At(o))&&(v=wn(h))):W=!1}W&&(p.set(h,v),s(v,h,r,u,p),p.delete(h)),_t(t,n,v)}function ln(t,e){return xn(jn(t,e,Xt),t+"")}var pn=rt?function(t,e){return rt(t,"toString",{configurable:!0,enumerable:!1,value:Dn(e),writable:!0})}:Xt;function hn(t,e){if(e)return t.slice();var n=t.length,r=Bt?Bt(n):new t.constructor(n);return t.copy(r),r}function dn(t){var e=new t.constructor(t.byteLength);return new Ut(e).set(new Ut(t)),e}function gn(t,e){var n=e?dn(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function _n(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function yn(t,e,n,r){var s=!n;n||(n={});for(var u=-1,p=e.length;++u<p;){var o=e[u],h=r?r(n[o],t[o],o,n,t):void 0;h===void 0&&(h=t[o]),s?yt(n,o,h):an(n,o,h)}return n}function bn(t){return ln(function(e,n){var r=-1,s=n.length,u=s>1?n[s-1]:void 0,p=s>2?n[2]:void 0;for(u=t.length>3&&typeof u=="function"?(s--,u):void 0,p&&Tn(n[0],n[1],p)&&(u=s<3?void 0:u,s=1),e=Object(e);++r<s;){var o=n[r];o&&t(e,o,r,u)}return e})}function mn(t){return function(e,n,r){for(var s=-1,u=Object(e),p=r(e),o=p.length;o--;){var h=p[t?o:++s];if(n(u[h],h,u)===!1)break}return e}}function ot(t,e){var n=t.__data__;return An(e)?n[typeof e=="string"?"string":"hash"]:n.map}function bt(t,e){var n=Ce(t,e);return sn(n)?n:void 0}function vn(t){var e=S.call(t,P),n=t[P];try{t[P]=void 0;var r=!0}catch{}var s=Ft.call(t);return r&&(e?t[P]=n:delete t[P]),s}function wn(t){return typeof t.constructor=="function"&&!Wt(t)?Fe(Gt(t)):{}}function Kt(t,e){var n=typeof t;return e=e??O,!!e&&(n=="number"||n!="symbol"&&we.test(t))&&t>-1&&t%1==0&&t<e}function Tn(t,e,n){if(!z(n))return!1;var r=typeof e;return(r=="number"?Tt(n)&&Kt(e,n.length):r=="string"&&e in n)?st(n[e],t):!1}function An(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function On(t){return!!Dt&&Dt in t}function Wt(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||tt;return t===n}function Sn(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}function Cn(t){return Ft.call(t)}function jn(t,e,n){return e=Ht(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,u=Ht(r.length-e,0),p=Array(u);++s<u;)p[s]=r[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=r[s];return o[e]=n(p),Ae(t,this,o)}}function mt(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var xn=In(pn);function In(t){var e=0,n=0;return function(){var r=De(),s=d-(r-n);if(n=r,s>0){if(++e>=g)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function En(t){if(t!=null){try{return et.call(t)}catch{}try{return t+""}catch{}}return""}function st(t,e){return t===e||t!==t&&e!==e}var vt=Vt(function(){return arguments}())?Vt:function(t){return K(t)&&S.call(t,"callee")&&!Ne.call(t,"callee")},wt=Array.isArray;function Tt(t){return t!=null&&Zt(t.length)&&!At(t)}function Pn(t){return K(t)&&Tt(t)}var Yt=Re||Fn;function At(t){if(!z(t))return!1;var e=it(t);return e==D||e==ht||e==m||e==ne}function Zt(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=O}function z(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function K(t){return t!=null&&typeof t=="object"}function Nn(t){if(!K(t)||it(t)!=H)return!1;var e=Gt(t);if(e===null)return!0;var n=S.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&et.call(n)==Ee}var qt=Rt?Se(Rt):cn;function zn(t){return yn(t,Qt(t))}function Qt(t){return Tt(t)?rn(t,!0):un(t)}var Rn=bn(function(t,e,n){Jt(t,e,n)});function Dn(t){return function(){return t}}function Xt(t){return t}function Fn(){return!1}f.exports=Rn})(lt,lt.exports);var Jn=lt.exports;const Kn=Mn(Jn);var Wn={VITE_OPENAI_API_KEY:"c2stVWRlRWFIWWZxQVBkQ1czZVNuTmFUM0JsYmtGSkRSTnp5cW9rRjFmR0ZBdE80Sm9S",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const x=Un("AI:runner-chat"),{VITE_OPENAI_API_KEY:te}=Wn;if(!te)throw new Error("missing openai api key");const Yn=Bn.Buffer.from(te,"base64").toString("utf-8"),Zn=new Gn({apiKey:Yn,dangerouslyAllowBrowser:!0}),tr=async({help:f,text:a})=>(b(typeof f=="object","help must be an object"),b(typeof a=="string","text must be a string"),await(await jt.create(f)).prompt(a));var B,Y,Z,G,A,$,q,xt,pt,ee;const R=class R{constructor(){j(this,q);j(this,pt);j(this,B,void 0);j(this,Y,void 0);j(this,Z,void 0);j(this,G,void 0);j(this,A,void 0)}static async create(a){var c,g;b(typeof a=="object","help must be an object");const i=JSON.stringify(a);if(!y(R,$).has(i)){const d=new R;U(d,A,"/chat-1.session.json"),U(d,B,a.instructions.join(`
`).trim()),U(d,Y,((c=a.config)==null?void 0:c.model)||"gpt-4-1106-preview"),await ct(g=d,pt,ee).call(g,a.commands),y(R,$).set(i,d)}return y(R,$).get(i)}async prompt(a){var g;b(typeof a=="string","text must be a string"),b(a.length,"text must not be empty");let i=[];await Hn(y(this,A))&&(i=await Ln(y(this,A))),b(Array.isArray(i),"messages must be an array"),y(this,B)&&(((g=i[0])==null?void 0:g.role)==="system"&&i.shift(),i.unshift({role:"system",content:y(this,B)})),a&&i.push({role:"user",content:a});const c=await ct(this,q,xt).call(this,i);return x("assistant",c),c}async executeTools(a){b(Array.isArray(a),"messages must be an array"),a=[...a];const i=a[a.length-1];if(!i.tool_calls)return i.content;x("toolCalls count:",i.tool_calls.length);for(const c of i.tool_calls){const{function:{name:g,arguments:d},id:O}=c;x("tool call:",g,d),b(y(this,G)[g],`missing action: ${g}`);const _={role:"tool",tool_call_id:O};a.push(_),await ft(a,y(this,A));try{const T=JSON.parse(d),m=await y(this,G)[g](T);x("tool call result:",m),m===void 0||typeof m=="string"?_.content=m||"":_.content=JSON.stringify(m,null,2)}catch(T){x("tool call error:",T),_.content=JSON.stringify($n(T),null,2)}}return await ft(a,y(this,A)),ct(this,q,xt).call(this,a)}};B=new WeakMap,Y=new WeakMap,Z=new WeakMap,G=new WeakMap,A=new WeakMap,$=new WeakMap,q=new WeakSet,xt=async function(a){var d,O,_,T,m,Q;const i={model:y(this,Y),temperature:0,messages:[...a],stream:!0,seed:1,tools:y(this,Z)},c={role:"assistant"};a.push(c),await ft(a,y(this,A)),x("streamCall started");const g=await Zn.chat.completions.create(i);x("streamCall placed");for await(const X of g){const k=(O=(d=X.choices[0])==null?void 0:d.delta)==null?void 0:O.content;k&&(c.content||(c.content=""),c.content+=k);const D=(T=(_=X.choices[0])==null?void 0:_.delta)==null?void 0:T.tool_calls;if(D){b(Array.isArray(D),"toolCalls must be an array"),c.tool_calls||(c.tool_calls=[]);for(const ht of D){const{index:I,...E}=ht;b(Number.isInteger(I),"toolCalls index must be an integer"),c.tool_calls[I]||(c.tool_calls[I]={});const H={function:{arguments:((m=c.tool_calls[I].function)==null?void 0:m.arguments)||""}};(Q=E==null?void 0:E.function)!=null&&Q.arguments&&(H.function.arguments+=E.function.arguments),Kn(c.tool_calls[I],E,H)}}await ft(a,y(this,A))}return x("streamCall complete"),this.executeTools(a)},pt=new WeakSet,ee=async function(a){if(b(Array.isArray(a),"commands must be an array"),!a.length)return;const i=[],c=new Set,g={};for(const d of a){x("loading command:",d);const[O,_]=d.split(":"),m=(await Vn(O))[_];b(m,`missing action: ${d}`),b(!c.has(_),`duplicate action: ${d}`),c.add(_),g[_]=m,i.push(qn(_,m))}U(this,G,g),U(this,Z,i)},j(R,$,new Map);let jt=R;const qn=(f,a)=>{const{api:i}=a;b(typeof i=="object","api must be an object"),b(typeof i.type=="string","api.type must be a string");const{...c}=i;return delete c.title,delete c.description,{type:"function",function:{name:f,description:i.description,parameters:c}}};export{tr as default};
